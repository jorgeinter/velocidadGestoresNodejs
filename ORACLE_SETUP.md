# Oracle Database Configuration Guide

This guide helps you configure Oracle Database connection for the velocity testing application.

## Prerequisites

1. **Oracle Database Installation**:

   - Oracle Database 21c XE (Express Edition) - Free for development
   - Oracle Database 19c or higher
   - Oracle Instant Client (for connection libraries)

2. **Download Oracle XE**: https://www.oracle.com/database/technologies/xe-downloads.html

## Installation Steps

### Option 1: Oracle Database 21c XE (Recommended for development)

1. **Download and Install Oracle XE**:

   - Download Oracle Database 21c XE
   - Run installer as Administrator
   - Set a strong password for system accounts (SYS, SYSTEM)
   - Default port: 1521
   - Default service name: XE or FREE

2. **Verify Installation**:
   - Service should be running: `OracleServiceXE`
   - Listener should be running: `OracleXETNSListener`

### Option 2: Oracle Database in Docker

```bash
# Pull Oracle XE image
docker pull container-registry.oracle.com/database/express:21.3.0-xe

# Run Oracle XE container
docker run -d \
  --name oracle-xe \
  -p 1521:1521 \
  -p 5500:5500 \
  -e ORACLE_PWD=123456789 \
  container-registry.oracle.com/database/express:21.3.0-xe
```

## Database Setup

### 1. Connect as Administrator

Using SQL\*Plus or SQL Developer:

```sql
-- Connect as SYS user
sqlplus sys/123456789@localhost:1521/FREE as sysdba
```

### 2. Create User and Database Objects

Run the provided SQL script or execute manually:

```sql
-- Create user (C## prefix required for common users)
CREATE USER C##dbproducto
    IDENTIFIED BY dbproducto
    DEFAULT TABLESPACE users
    TEMPORARY TABLESPACE temp
    QUOTA UNLIMITED ON users;

-- Grant privileges
GRANT CONNECT, RESOURCE TO C##dbproducto;

-- Connect as the new user
CONNECT C##dbproducto/dbproducto@localhost:1521/XE

-- Create table
CREATE TABLE producto (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(100) NOT NULL,
    categoria VARCHAR2(100) NOT NULL,
    precio NUMBER(10,2) NOT NULL,
    stock NUMBER(10) NOT NULL
);

-- Insert sample data
INSERT INTO producto (nombre, categoria, precio, stock) VALUES
('Laptop', 'Electrónica', 1200.00, 10),
('Smartphone', 'Electrónica', 800.00, 25),
('Tablet', 'Electrónica', 500.00, 15),
('Cámara', 'Fotografía', 600.00, 5),
('Auriculares', 'Accesorios', 150.00, 30);

COMMIT;
```

## Connection Configuration

### Environment Variables

Update your `.env` file:

```env
# Oracle Database Configuration
ORACLE_USER=C##dbproducto           # Common user with C## prefix
ORACLE_PASSWORD=dbproducto          # User password
ORACLE_HOST=localhost               # Database host
ORACLE_PORT=1521                    # Database port
ORACLE_CONNECT_STRING=localhost:1521/XE  # Full connection string
```

### Common Connection Strings

- **Oracle XE**: `localhost:1521/XE`
- **Oracle FREE**: `localhost:1521/FREE` <-- This is the used
- **Oracle with SID**: `localhost:1521:ORCL`
- **Remote Oracle**: `remote_host:1521/service_name`

## Testing Connection

1. **Using SQL\*Plus**:

   ```bash
   sqlplus C##dbproducto/dbproducto@localhost:1521/FREE
   ```

2. **Using the Application**:
   - Visit `http://localhost:3000`
   - Click "Test Oracle Connection"

## Troubleshooting

### Common Issues

1. **ORA-12541: TNS:no listener**

   - Check if Oracle TNS Listener is running
   - Restart listener: `lsnrctl stop` then `lsnrctl start`
     `

2. **ORA-12514: TNS:listener does not currently know of service**

   - Verify service name in connection string
   - Check `tnsnames.ora` file

3. **ORA-01017: invalid username/password**

   - Verify user credentials
   - Check if user exists: `SELECT username FROM dba_users WHERE username = 'C##DBPRODUCTO';`

4. **ORA-28009: connection as SYS should be as SYSDBA**
   - Add `as sysdba` when connecting as SYS
   - Use regular user for application connections

### Service Management

**Windows Services to check**:

- `OracleServiceXE` - Database service
- `OracleXETNSListener` - Network listener

**Start/Stop Commands**:

```cmd
# Start services
net start OracleServiceXE
net start OracleXETNSListener

# Stop services
net stop OracleXETNSListener
net stop OracleServiceXE
```

## Performance Tips

1. **Connection Pooling**: The application uses connection pooling for better performance
2. **Tablespace Management**: Monitor tablespace usage for production
3. **Memory Settings**: Adjust SGA and PGA for better performance

## Tools

1. **SQL Developer**: Free Oracle GUI tool
2. **SQL\*Plus**: Command-line interface
3. **Oracle Enterprise Manager**: Web-based administration
4. **Toad**: Third-party Oracle management tool

## Additional Resources

- [Oracle Database Documentation](https://docs.oracle.com/en/database/)
- [Oracle XE Installation Guide](https://docs.oracle.com/en/database/oracle/oracle-database/21/xeinw/)
- [Oracle SQL Developer](https://www.oracle.com/tools/downloads/sqldev-downloads.html)
